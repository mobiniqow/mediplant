{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <title>Masterkart - الگوی HTML تجارت الکترونیک چند منظوره</title>
    <meta name="keywords"
          content="Bootstrap 5.x, ecommerce, farming, food market, grocery market, grocery shop, grocery store, grocery supper market, multi vendor, organic food, supermarket, supermarket grocery">
    <meta name="description" content="Multipurpose eCommerce HTML Template">
    <meta name="author" content="Pilarest">

    <!-- site Favicon -->
    <link rel="icon" href="{% static 'assets/img/favicon/favicon.png' %}" sizes="32x32">

    <!-- css Icon Font -->
    <link rel="stylesheet" href="{% static 'assets/css/vendor/msicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/all.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/fontawesome.css' %}">

    <!-- css All Plugins Files -->
    <link rel="stylesheet" href="{% static 'assets/css/plugins/animate.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/bootstrap-select.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/swiper-bundle.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/slick.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/nouislider.css' %}">

    <!-- Main Style -->
    <link rel="stylesheet" id="main_style" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/responsive.css' %}">
    <link rel="stylesheet" class="color-css" href="{% static 'assets/css/color-01.css' %}">

</head>

<body>
<!-- Loader -->
<div id="ms-overlay">
    <div class="loader"></div>
</div>

<!-- Header start  -->
{% include '../extentions/header.html' with categories=categories_map is_active=is_active medic_notification=medic_notification shop_notification=shop_notification %}
<!-- Header End  -->

<!-- Category sidebar Start --> 
<!-- Category sidebar End -->

<!-- Cart sidebar Start -->
<div class="ms-side-cart-overlay"></div>
{% include '../extentions/shops_basket.html' with basket=basket toke=token %}
<!-- Cart sidebar End -->

<!-- Wishlist sidebar Start -->
<div class="ms-side-wish-overlay"></div>
<div id="ms-side-wish" class="ms-side-wish">
    <div class="ms-wish-inner">
        <div class="ms-wish-top">
            <div class="ms-wish-title">
                <span class="wish_title">لیست علاقه مندی‌ها</span>
                <a href="javascript:void(0)" class="ms-wish-close"><img src="{% static 'assets/img/icons/close.svg' %}"
                                                                        class="svg_img pro_svg" alt="close"></a>
            </div>
            <ul class="ms-wish-pro-items">
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/18_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">لیمو</a>
                        <span class="wish-price"><span>25 هزار x </span> کیلوگرم </span>
                        <div class="ms-availability">
                            <p class="stock avail">موجود در انبار</p>
                            <a href="" class="ms-btn-2">خرید</a>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/20_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">مارچوبه</a>
                        <span class="wish-price"><span>5 هزار x</span> گرم</span>
                        <div class="ms-availability">
                            <p class="stock not-avail">موجودی</p>
                            <div class="ms-wish-contact-btns">
                                <a href="" class="ms-btn-2 btn-disabled">خرید</a>
                                <a href="" class="ms-btn-1">مخاطب</a>
                            </div>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/31_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">انبه</a>
                        <span class="wish-price"><span>59 هزار x</span> بسته</span>
                        <div class="ms-availability">
                            <p class="stock avail">موجود در انبار</p>
                            <a href="" class="ms-btn-2">خرید</a>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/23_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">توت فرنگی</a>
                        <span class="wish-price"><span>59 هزار x</span> کیلوگرم</span>
                        <div class="ms-availability">
                            <p class="stock avail">موجود در انبار</p>
                            <a href="" class="ms-btn-2">خرید</a>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- Wishlist sidebar End -->

<!-- Breadcrumb start -->
<div class="ms-breadcrumb m-b-30">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="row ms_breadcrumb_inner">
                    <div class="col-md-6 col-sm-12">
                        <h2 class="ms-breadcrumb-title">صفحه فروشگاه</h2>
                    </div>
                    <div class="col-md-6 col-sm-12">
                        <!-- ms-breadcrumb-list start -->
                        <ul class="ms-breadcrumb-list">
                            <li class="ms-breadcrumb-item"><a href="/">خانه</a><i
                                    class="fas fa-chevron-left"></i></li>
                            <li class="ms-breadcrumb-item active">محصولات</li>
                        </ul>
                        <!-- ms-breadcrumb-list end -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb end -->

<!-- Category section -->
<section class="ms-category body-bg p-b-30">
    <div class="container">
        <div class="row">
            <div class="col-xl-12 border-content-color">
                <div class="ms-category-block owl-carousel" dir="ltr">
                
                    {% for model in categories %}
                        <div class="ms-cat-box ms-cat-box-9">
                            <a href="/product?category={{ model.id }}" class="ms-cat-icon">
                                <img src="{{ model.image.url }}" class="svg_img" alt="icon">
                                <h4 class="ms-cat-title">{{ model.name }}</h4>
                            </a>
                        </div>
                    {% endfor %}
                
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Category section End -->

<!-- Shop section -->
<section class="ms-shop padding-tb-30">
    <div class="container">
        <div class="row">
            <div class="ms-shop-rightside col-lg-9 order-lg-last col-md-12 order-md-first margin-b-30">
                <!-- Shop Top Start -->
                <div class="ms-pro-list-top d-flex">
                    <div class="col-md-6 ms-grid-list">
                        <div class="ms-gl-btn">
                            <button class="grid-btn btn-grid active">
                                <img src="{% static 'assets/img/icons/grid.svg' %}" class="svg_img gl_svg" alt="">
                            </button>
                            <button class="grid-btn btn-list">
                                <img src="{% static 'assets/img/icons/list.svg' %}" class="svg_img gl_svg" alt="">
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6 ms-sort-select">
                        <div class="ms-select-inner">
                            <select name="ms-select" id="ms-select">
                                <option selected disabled>ترتیب بندی</option>
                                <option value="3">جدیدترین</option>
                                <option value="4">بیشترین بازدید</option>
                                <option value="5">قیمت کمتر به بیشتر</option>
                                <option value="6">قیمت بیشتر به کمتر</option>
                            </select>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>

                <div class="shop-pro-content">
                    <div class="shop-pro-inner">
                        <div class="row" id="items">
                            <!-- محصولات به صورت داینامیک اینجا اضافه می‌شوند -->
                        </div>
                    </div>

                    <!-- Pagination Start -->
                    <div class="ms-pro-pagination">
                        <span id="pagination-info">نمایش 1-12 از 21 مورد</span>
                        <ul class="ms-pro-pagination-inner" id="pagination">
                            <!-- لینک‌های پیجینیشن به صورت داینامیک اضافه می‌شوند -->
                        </ul>
                    </div>
                    <!-- Pagination End -->
                </div>

                <!--Shop content End -->

            </div>
            <!-- Sidebar Area Start -->
            <div class="ms-shop-sidebar col-lg-3 order-lg-first col-md-12 order-md-last m-t-991">
                <div id="shop_sidebar">
                    <div class="ms-sidebar-wrap">
                        <!-- Sidebar Category Block -->
                        <div class="ms-sidebar-block">
                            <div class="ms-sb-title">
                                <h3 class="ms-sidebar-title">جنس محصول
                                    <div class="ms-sidebar-res"><i class="fas fa-chevron-down"></i></div>
                                </h3>
                            </div>
                            <div class="ms-sb-block-content" id="category-list">
                                <ul>
                                    <!-- Categories will be populated dynamically from API -->
                                </ul>
                            </div>
                        </div>
                        <!-- Sidebar Weight Block -->
                        <div class="ms-sidebar-block">
                            <div class="ms-sb-title">
                                <h3 class="ms-sidebar-title">دسته بندی
                                    <div class="ms-sidebar-res"><i class="fas fa-chevron-down"></i></div>
                                </h3>
                            </div>
                            <div class="ms-sb-block-content">
                                <ul id="category-list1"></ul>
                            </div>
                        </div>
                        <!-- Sidebar Price Block -->
                        <div class="ms-sidebar-block">
{#    <div class="ms-sb-title">#}
{#        <h3 class="ms-sidebar-title">قیمت#}
{#            <div class="ms-sidebar-res"><i class="fas fa-chevron-down"></i></div>#}
{#        </h3>#}
{#    </div>#}
{#    <div class="ms-sb-block-content ms-price-range-slider es-price-slider" dir="ltr">#}
{#        <div class="ms-price-filter">#}
{#            <div class="ms-price-input">#}
{#                <label class="filter__label">#}
{#                    از<input type="text" class="filter__input" id="min-price-input">#}
{#                </label>#}
{#                <span class="ms-price-divider"></span>#}
{#                <label class="filter__label">#}
{#                    به<input type="text" class="filter__input" id="max-price-input">#}
{#                </label>#}
{#            </div>#}
{#            <div id="ms-sliderPrice" class="filter__slider-price" data-min="0" data-max="1000000" data-step="10"></div>#}
{#        </div>#}
{##}
{#    </div>#}
</div>

                        <!-- Sidebar tags -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Shop section End -->

<!-- Footer Start -->
{% include './extentions/footer.html' %}
<!-- Footer Area End -->

<!-- Quickview Modal -->
<div class="modal fade quickview-modal" id="ms_quickview_modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close qty_close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-5 col-sm-12 col-xs-12" dir="ltr">
                        <div class="qty-product-cover">
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/1_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/2_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/3_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/4_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/5_1.jpg' %}"
                                     alt="">
                            </div>
                        </div>
                        <div class="qty-nav-thumb">
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/1_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/2_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/3_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/4_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/5_1.jpg' %}"
                                     alt="">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7 col-sm-12 col-xs-12">
                        <div class="quickview-pro-content">
                            <h5 class="ms-quick-title"><a href="product-left-sidebar.html">پاکت میوه خشک مخلوط تریل
                                ارگانیک مرغوب</a></h5>
                            <div class="ms-quickview-rating">
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star"></i>
                            </div>

                            <div class="ms-quickview-desc">لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و
                                با استفاده از طراحان گرافیک است. چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان
                                که لازم است
                            </div>
                            <div class="ms-quickview-price">
                                <span class="new-price">150 هزار تومان</span>
                                <span class="old-price">130 هزار تومان</span>
                            </div>

                            <div class="ms-pro-variation">
                                <div class="ms-pro-variation-inner ms-pro-variation-size ms-pro-size">
                                    <span>اندازه</span>
                                    <div class="ms-pro-variation-content">
                                        <ul class="ms-opt-size">
                                            <li class="active"><a href="javascript:void(0)" class="ms-opt-sz"
                                                                  data-tooltip="Small">250 گرم</a></li>
                                            <li><a href="javascript:void(0)" class="ms-opt-sz" data-tooltip="Medium">500
                                                گرم</a></li>
                                            <li><a href="javascript:void(0)" class="ms-opt-sz" data-tooltip="Large">1
                                                کیلوگرم</a></li>
                                            <li><a href="javascript:void(0)" class="ms-opt-sz"
                                                   data-tooltip="Extra Large">2 کیلوگرم</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="ms-quickview-qty">
                                <div class="qty-plus-minus">
                                    <input class="qty-input" type="text" name="ms_qtybtn" value="1">
                                </div>
                                <div class="ms-quickview-cart ">
                                    <button class="ms-btn-3"><img src="{% static 'assets/img/icons/pro_cart.svg' %}"
                                                                  class="svg_img pro_svg" alt=""> خرید
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Quickview Modal end -->

<!-- Add to Cart Notify -->
<div class="ms-cart-notify">
    <a href="javascript:void(0)" class="ms-cart-toggle"><img src="{% static 'assets/img/icons/pro_cart.svg' %}"
                                                             class="svg_img" alt="cart"><span>3</span></a>
</div>

<!-- Add to Wishlist Notify  -->
<div class="ms-wish-notify"></div>

<!-- Add to Compare list Notify  -->
<div class="ms-compare-notify"></div>

<!-- Back to top  -->
<a class="ms-back-to-top"></a>

<!-- Features sidebar  -->
{#<div class="ms-features-sidebar-overlay"></div>#}
{#<div class="ms-features-sidebar">#}
{#    <div class="tool-title">#}
{#        <h3>تنظیمات</h3>#}
{#    </div>#}
{#    <a href="#" class="ms-tools-sidebar-toggle open-features">#}
{#        <img alt="icon" src="{% static 'assets/img/icons/setting.svg' %}" class="svg_img">#}
{#    </a>#}
{#    <div class="ms-features-block">#}
{#        <div class="ms-features-title">رنگ‌ها</div>#}
{#        <ul class="bg-panel ms-change-color">#}
{#            <li class="active" data-color="01">#}
{#                <a href="javascript:void(0)" class="colorcode1"></a>#}
{#            </li>#}
{#            <li data-color="02">#}
{#                <a href="javascript:void(0)" class="colorcode2"></a>#}
{#            </li>#}
{#            <li data-color="03">#}
{#                <a href="javascript:void(0)" class="colorcode3"></a>#}
{#            </li>#}
{#            <li data-color="04">#}
{#                <a href="javascript:void(0)" class="colorcode4"></a>#}
{#            </li>#}
{#            <li data-color="05">#}
{#                <a href="javascript:void(0)" class="colorcode5"></a>#}
{#            </li>#}
{#            <li data-color="06">#}
{#                <a href="javascript:void(0)" class="colorcode6"></a>#}
{#            </li>#}
{#            <li data-color="07" class="">#}
{#                <a href="javascript:void(0)" class="colorcode7"></a>#}
{#            </li>#}
{#            <li data-color="08">#}
{#                <a href="javascript:void(0)" class="colorcode8"></a>#}
{#            </li>#}
{#            <li data-color="09">#}
{#                <a href="javascript:void(0)" class="colorcode9"></a>#}
{#            </li>#}
{#        </ul>#}
{#    </div>#}
{#    <div class="ms-features-block">#}
{#        <div class="ms-tools-sidebar-content">#}
{#            <div class="ms-features-title">حالت پس رمینه</div>#}
{#            <div class="ms-change-mode active" id="ms-change-mode">#}
{#                <div class="ms-mode-switch">#}
{#                    <div class="ms-mode-btn">انتخاب</div>#}
{#                    <div class="ms-mode-on">روشن</div>#}
{#                    <div class="ms-mode-off">خاموش</div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}

<!-- Plugins JS -->
<script src="{% static 'assets/js/plugins/jquery-3.5.1.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/popper.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/bootstrap-select.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/fontawesome.js' %}"></script>
<script src="{% static 'assets/js/plugins/owl.carousel.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/swiper-bundle.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/infiniteslidev2.js' %}"></script>
<script src="{% static 'assets/js/plugins/jquery.zoom.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/slick.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/nouislider.js' %}"></script>

<!-- Main Js -->
<script src="{% static 'assets/js/main.js' %}"></script>
{# #}
<script>
    var productType = [];
    var categories = [];
    var orderType = "";

    function fetchProducts(page = 1, filters = {}) {
        const apiEndpoint = '/product/api/';
        let queryString = `?page=${page}`;
        productType.forEach((value, index) => {
            queryString += `&type=${value}`;
        })
        categories.forEach((value, index) => {
            queryString += `&category=${value}`;
        })
        if (orderType != "") {
            queryString += `&ordering=${orderType}`
        }
        console.log(`queryString ${queryString}`)

        return $.ajax({
            url: apiEndpoint + queryString,
            method: 'GET',
            error: function (error) {
                console.error('خطا در بارگذاری محصولات:', error);
            }
        });
    }

    function renderProducts(products) {
        const itemsContainer = $('#items');
        itemsContainer.empty();  // پاک‌کردن محصولات قبلی

        products.forEach(function (product) {
            // گرفتن تصاویر اول و دوم از آرایه تصاویر
            const image1 = product.image[0]?.image || ''; // تصویر اول
            const image2 = product.image[1]?.image || ''; // تصویر دوم

            // نمایش 12 کاراکتر اول از نام فروشگاه و سپس نقطه چین
            const shopName = product.name.length > 12 ? product.name.slice(0, 12) + '...' : product.name;

            const productHtml = `
        <div class="col-lg-4 col-md-6 col-sm-6 col-xs-6 mb-6 pro-gl-content ms-product-content" data-id="${product.id}">
            <div class="ms-product-inner">
                <div class="ms-pro-image-outer">
                    <div class="ms-pro-image">
                        <a href="javascript:void(0);" class="image">
                            <img class="main-image" src="${image1}" alt="Product">
                            <img class="hover-image" src="${image2}" alt="Product">
                        </a>
                    </div>
                </div>
                <div class="ms-pro-content">
                    <h6 class="ms-pro-stitle">${shopName}</h6> <!-- نام فروشگاه -->
                    <h5 class="ms-pro-title"><a href="/shop/${product.shop}/product/${product.id}">  ${shopName}</a></h5>
                    <div class="ms-pro-rat-price">
                        <span class="ms-price">
{#                            <span class="new-price">${product.formatted_price} تومان</span>#}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        `;
            itemsContainer.append(productHtml);
        });

        // اضافه کردن رویداد کلیک به هر div محصول
        $('.pro-gl-content').on('click', function () {
            const productId = $(this).data('id'); // دریافت id محصول
            window.location.href = `/search/product/${productId}/`; // هدایت به صفحه محصول
        });
    }

function renderPagination(currentPage, totalPages) {
    const paginationContainer = $('#pagination');
    paginationContainer.empty();

    // نمایش لینک "قبلی" اگر صفحه فعلی بزرگتر از 1 باشد
    if (currentPage > 1) {
        paginationContainer.append(`<li><a href="#" class="prev" data-page="${currentPage - 1}">قبلی</a></li>`);
    }

    // همیشه صفحه اول را نشان می‌دهیم
    paginationContainer.append(`<li><a href="#" data-page="1" class="${currentPage === 1 ? 'active' : ''}">1</a></li>`);

    // اگر صفحه فعلی بیشتر از 3 باشد، نمایش "..."
    if (currentPage > 3) {
        paginationContainer.append(`<li><span>...</span></li>`);
    }

    // نمایش صفحات میانه
    const pageRange = 2;
    const startPage = Math.max(2, currentPage - pageRange);
    const endPage = Math.min(totalPages - 1, currentPage + pageRange);

    for (let i = startPage; i <= endPage; i++) {
        const activeClass = i === currentPage ? 'active' : '';
        paginationContainer.append(`<li><a href="#" class="${activeClass}" data-page="${i}">${i}</a></li>`);
    }

    // اگر صفحه فعلی خیلی دور از آخرین صفحه باشد، نمایش "..."
    if (currentPage < totalPages - 2) {
        paginationContainer.append(`<li><span>...</span></li>`);
    }

    // همیشه صفحه آخر را نشان می‌دهیم، مگر اینکه تعداد صفحات 1 باشد
    if (totalPages > 1) {
        paginationContainer.append(`<li><a href="#" data-page="${totalPages}" class="${currentPage === totalPages ? 'active' : ''}">${totalPages}</a></li>`);
    }

    // نمایش لینک "بعدی" اگر صفحه فعلی کوچکتر از صفحه آخر باشد
    if (currentPage < totalPages) {
        paginationContainer.append(`<li><a href="#" class="next" data-page="${currentPage + 1}">بعدی</a></li>`);
    }
}

    function loadProducts(page = 1, filters = {}) {
        fetchProducts(page, filters).done(function (response) {
            renderProducts(response.results);
            renderPagination(page, response.total_pages);
            $('#pagination-info').text(`نمایش ${(page - 1) * 9 + 1}-${Math.min(page * 9, response.count)} از ${response.count} مورد`);
        });
    }

    $(document).ready(function () {
        var currentFilters = {};
        loadProducts();
        $(document).on('click', '#pagination a', function (event) {
            event.preventDefault();
            const page = $(this).data('page');
            if (page) {
                loadProducts(page, currentFilters);
            }
        });
        $('#filter-form').submit(function (event) {
            event.preventDefault();
            currentFilters = {
                price_min: $('#price_min').val(),
                price_max: $('#price_max').val(),
                material: $('#material').val(),
                product: $('#product').val(),
                shop: $('#shop').val(),
            };
            loadProducts(1, currentFilters);
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        fetchCategories();

        function fetchCategories() {
            fetch('/product/product-types') // Adjust API URL as necessary
                .then(response => response.json())
                .then(data => {
                    const categoryList = document.querySelector('#category-list ul');
                    categoryList.innerHTML = data.map(category => {
                        // کوتاه کردن نام دسته‌بندی در صورتی که طول آن بیشتر از 23 کاراکتر باشد
                        const categoryName = category.label.length > 23 ? category.label.slice(0, 23) + '...' : category.label;

                        return `
                        <li>
                            <div class="ms-sidebar-block-item" style="display: flex; align-items: center;">
                                <input type="checkbox" id="category-${category.value}" onchange="toggleSelection(${category.value})">
                                <span style="margin-right: 10px; cursor: pointer; width: 20px; height: 20px;"></span>
                                <label for="category-${category.value}" style="flex: 1; display: block; position: relative; z-index: 0;">
                                    <span class="label-text" style="margin-right: 5px;">${categoryName}</span>
                                </label>
                                <span class="checked"></span>
                            </div>
                        </li>
                    `;
                    }).join('');
                })
                .catch(error => console.error('Error fetching categories:', error));
        }

        function getProductCount(value) {
            const productCounts = {
                0: 68, // گیاه
                1: 58, // عرق
                // Add counts for other categories as needed
            };
            return productCounts[value] || 0;
        }

        {#var productType = [];#}

        window.toggleSelection = function (value) {
            {#console.log(productType);#}
            const index = productType.indexOf(value);
            if (index > -1) {
                productType.splice(index, 1); // Remove if already selected
            } else {
                productType.push(value); // Add if not selected
            }
            loadProducts()
            displaySelectedItems();
        };

        function displaySelectedItems() {
            console.log("Selected Items:", productType);
            // You can display selected items in your UI as needed
        }
    });
</script>
<script>
    async function fetchCategories() {
        try {
            const response = await fetch('/product/categories');
            const categories = await response.json();
            console.log(categories)
            generateCategoryList(categories);
        } catch (error) {
            console.error('Error fetching categories:', error);
        }
    }

    window.toggleSelection1 = function (value) {
        {#console.log(categories);#}
        const index = categories.indexOf(value);
        if (index > -1) {
            categories.splice(index, 1); // Remove if already selected
        } else {
            categories.push(value); // Add if not selected
        }
        loadProducts()
    };

    function generateCategoryList(categories) {
        const categoryList = document.getElementById('category-list1');
        categories.forEach(category => {
            if (category.parent === null) {
                // Parent category
                const parentItem = document.createElement('li');
                const parentBlock = document.createElement('div');
                parentBlock.classList.add('ms-sidebar-block-item');
                parentBlock.innerHTML = `<span>${category.name.length > 23 ? category.name.slice(0, 23) + '...' : category.name}</span>`;

                parentItem.appendChild(parentBlock);
                const subList = document.createElement('ul');
                categories.forEach(subCategory => {
                    if (subCategory.parent === category.id) {
                        const subItem = document.createElement('li');
                        const subBlock = document.createElement('div');
                        subBlock.classList.add('ms-sidebar-block-item');
                        subBlock.innerHTML = `<input type="checkbox" onchange="toggleSelection1(${subCategory.id})" id="category-${subCategory.id}">
<a href="#">${subCategory.name.length > 23 ? subCategory.name.slice(0, 23) + '...' : subCategory.name}</a>
<span class="checked"></span>    <span class="checked"></span>
                        `;
                        subItem.appendChild(subBlock);
                        subList.appendChild(subItem);
                    }
                });
                parentItem.appendChild(subList);
                categoryList.appendChild(parentItem);
            }
        });
    }

    // Fetch categories when the page loads
    document.addEventListener('DOMContentLoaded', fetchCategories);
</script>
<script>
    // پیدا کردن المنت select
    const selectElement = document.getElementById('ms-select');
    selectElement.addEventListener('change', function () {
        const selectedValue = selectElement.value;
        if (selectedValue == "5") {
            orderType = "-price"
            console.log("قیمت کمتر به بیشتر انتخاب شد.");
        } else if (selectedValue == "6") {
            orderType = "price"
            console.log("قیمت بیشتر به کمتر انتخاب شد.");
        } else if (selectedValue == "4") {
            orderType = "views"
            console.log("بیشترین بازدید.");
        } else if (selectedValue == "3") {
            orderType = "id"
            console.log("جدیدترین.");
        }
        loadProducts();
    });
</script>
<script>
$(document).ready(function() {
    // فرمت کردن قیمت به صورت هزارگان
    function formatPrice(value) {
        // اطمینان از این که عدد وارد شده درست است
        value = value.replace(/[^0-9]/g, ''); // حذف هر چیزی که عدد نیست
        return value ? Number(value).toLocaleString() : '';
    }

    // هنگام وارد کردن داده در فیلد "از"
    $("#min-price-input").on("input", function() {
        var formattedValue = formatPrice($(this).val());
        $(this).val(formattedValue); // نمایش مقدار فرمت شده در فیلد
    });

    // هنگام وارد کردن داده در فیلد "به"
    $("#max-price-input").on("input", function() {
        var formattedValue = formatPrice($(this).val());
        $(this).val(formattedValue); // نمایش مقدار فرمت شده در فیلد
    });

    // اسلایدر برای تنظیم مقادیر
    {#var slider = $("#ms-sliderPrice");#}
    {#slider.slider({#}
    {#    min: slider.data("min"),#}
    {#    max: slider.data("max"),#}
    {#    step: slider.data("step"),#}
    {#    slide: function(event, ui) {#}
    {#        // مقادیر اسلایدر را به فرمت هزارگان تبدیل کن#}
    {#        var minPrice = formatPrice(ui.values[0].toString());#}
    {#        var maxPrice = formatPrice(ui.values[1].toString());#}
    {##}
    {#        $("#min-price-input").val(minPrice);#}
    {#        $("#max-price-input").val(maxPrice);#}
    {#    }#}
    {#});#}
});

</script>
</body>

</html>
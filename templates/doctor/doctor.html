{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <title>Masterkart - الگوی HTML تجارت الکترونیک چند منظوره</title>
    <meta name="keywords"
          content="Bootstrap 5.x, ecommerce, farming, food market, grocery market, grocery shop, grocery store, grocery supper market, multi vendor, organic food, supermarket, supermarket grocery">
    <meta name="description" content="Multipurpose eCommerce HTML Template">
    <meta name="author" content="Pilarest">

    <link rel="icon" href="{% static 'assets/img/favicon/favicon.png' %}" sizes="32x32">

    <link rel="stylesheet" href="{% static 'assets/css/vendor/msicons.min.css' %}">

    <link rel="stylesheet" href="{% static 'assets/css/plugins/animate.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/bootstrap-select.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/swiper-bundle.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/slick.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/nouislider.css' %}">


    <link rel="stylesheet" id="main_style" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/responsive.css' %}">
    <link rel="stylesheet" class="color-css" href="{% static 'assets/css/color-01.css' %}">

</head>

<body>
<!-- Loader -->
<div id="ms-overlay">
    <div class="loader"></div>
</div>

{% include '../extentions/header.html' with categories=categories_map is_active=is_active medic_notification=medic_notification shop_notification=shop_notification %}

<!-- Header End  -->

<!-- Category sidebar Start -->
<div class="ms-side-cat-overlay"></div>
{% include '../extentions/shops_basket.html' with basket=basket toke=token %}
<!-- Category sidebar End -->

<!-- Cart sidebar Start -->
<div class="ms-side-cart-overlay"></div>
<div id="ms-side-cart" class="ms-side-cart">
    <div class="ms-cart-inner">
        <div class="ms-cart-top">
            <div class="ms-cart-title">
                <span class="cart_title">سبد خرید من</span>
                <a href="javascript:void(0)" class="ms-cart-close"><img src="{% static 'assets/img/icons/close.svg' %}"
                                                                        class="svg_img pro_svg" alt="close"></a>
            </div>
            <ul class="ms-cart-pro-items">
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/25_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="cart-pro-title">لیمو تازه</a>
                        <span class="cart-price"><span>2500 تومان x</span> کیلوگرم</span>
                        <div class="qty-plus-minus">
                            <input class="qty-input" type="text" name="ms-qtybtn" value="1">
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/17_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="cart-pro-title">زنجبیل - ارگانیک</a>
                        <span class="cart-price"><span>5000 تومان x</span> گرم</span>
                        <div class="qty-plus-minus">
                            <input class="qty-input" type="text" name="ms-qtybtn" value="1">
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/2_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="cart-pro-title"> بسته خرما</a>
                        <span class="cart-price"><span>6000 تومان x</span> بسته</span>
                        <div class="qty-plus-minus">
                            <input class="qty-input" type="text" name="ms-qtybtn" value="1">
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
            </ul>
        </div>
        <div class="ms-cart-bottom">
            <div class="cart-sub-total">
                <table class="table cart-table">
                    <tbody>
                    <tr>
                        <td class="text-left">جمع فرعی:</td>
                        <td class="text-right">300 هزار</td>
                    </tr>
                    <tr>
                        <td class="text-left">مالیات بر ارزش افزوده (20%):</td>
                        <td class="text-right">60 هزار</td>
                    </tr>
                    <tr>
                        <td class="text-left">جمع :</td>
                        <td class="text-right primary-color">360 هزار</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="cart_btn">
                <a href="cart.html" class="ms-btn-1">مشاهده سبد خرید</a>
                <a href="checkout.html" class="ms-btn-2">بررسی خرید</a>
            </div>
        </div>
    </div>
</div>
<!-- Cart sidebar End -->

<!-- Wishlist sidebar Start -->
<div class="ms-side-wish-overlay"></div>
<div id="ms-side-wish" class="ms-side-wish">
    <div class="ms-wish-inner">
        <div class="ms-wish-top">
            <div class="ms-wish-title">
                <span class="wish_title">لیست علاقه مندی‌ها</span>
                <a href="javascript:void(0)" class="ms-wish-close"><img src="{% static 'assets/img/icons/close.svg' %}"
                                                                        class="svg_img pro_svg" alt="close"></a>
            </div>
            <ul class="ms-wish-pro-items">
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/18_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">لیمو</a>
                        <span class="wish-price"><span>25 هزار x </span> کیلوگرم </span>
                        <div class="ms-availability">
                            <p class="stock avail">موجود در انبار</p>
                            <a href="" class="ms-btn-2">خرید</a>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/20_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">مارچوبه</a>
                        <span class="wish-price"><span>5 هزار x</span> گرم</span>
                        <div class="ms-availability">
                            <p class="stock not-avail">موجودی</p>
                            <div class="ms-wish-contact-btns">
                                <a href="" class="ms-btn-2 btn-disabled">خرید</a>
                                <a href="" class="ms-btn-1">مخاطب</a>
                            </div>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/31_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">انبه</a>
                        <span class="wish-price"><span>59 هزار x</span> بسته</span>
                        <div class="ms-availability">
                            <p class="stock avail">موجود در انبار</p>
                            <a href="" class="ms-btn-2">خرید</a>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
                <li>
                    <a href="product-left-sidebar.html" class="ms-pro-img"><img
                            src="{% static 'assets/img/product-images/23_1.jpg' %}" alt="product"></a>
                    <div class="ms-pro-content">
                        <a href="product-left-sidebar.html" class="wish-pro-title">توت فرنگی</a>
                        <span class="wish-price"><span>59 هزار x</span> کیلوگرم</span>
                        <div class="ms-availability">
                            <p class="stock avail">موجود در انبار</p>
                            <a href="" class="ms-btn-2">خرید</a>
                        </div>
                        <a href="javascript:void(0)" class="remove">×</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- Wishlist sidebar End -->

<!-- Breadcrumb start -->
<div class="ms-breadcrumb m-b-30">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="row ms_breadcrumb_inner">
                    <div class="col-md-6 col-sm-12">
                        <h2 class="ms-breadcrumb-title">صفحه فروشگاه</h2>
                    </div>
                    <div class="col-md-6 col-sm-12">
                        <!-- ms-breadcrumb-list start -->
                        <ul class="ms-breadcrumb-list">
                            <li class="ms-breadcrumb-item"><a href="index.html">خانه</a><i
                                    class="fas fa-chevron-left"></i></li>
                            <li class="ms-breadcrumb-item active">صفحه فروشگاه</li>
                        </ul>
                        <!-- ms-breadcrumb-list end -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb end -->

<!-- Category section -->
{#<section class="ms-category ms-category-shop body-bg p-b-30">#}
{#    <div class="container">#}
{#        <div class="row">#}
{#            <div class="col-xl-12 border-content-color">#}
{#                <div class="ms-category-block owl-carousel" dir="ltr">#}
{#                    <div class="ms-cat-box ms-cat-box-1">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <span class="ms-lbl">%30</span>#}
{#                            <img src="{% static 'assets/img/icons/cat-1.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">میوه ها</h4>#}
{#                            <p class="items" dir="rtl">320 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-2">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <img src="{% static 'assets/img/icons/cat-2.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">نانوایی</h4>#}
{#                            <p class="items" dir="rtl">65 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-3">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <span class="ms-lbl">%15</span>#}
{#                            <img src="{% static 'assets/img/icons/cat-3.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">سبزیجات</h4>#}
{#                            <p class="items" dir="rtl">548 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-4">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <span class="ms-lbl">%10</span>#}
{#                            <img src="{% static 'assets/img/icons/cat-4.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">شیر لبنی</h4>#}
{#                            <p class="items" dir="rtl">48 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-5">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <img src="{% static 'assets/img/icons/cat-5.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">میان وعده</h4>#}
{#                            <p class="items" dir="rtl">59 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-6">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <img src="{% static 'assets/img/icons/cat-6.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">آبمیوه و نوشیدنی </h4>#}
{#                            <p class="items" dir="rtl">845 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-7">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <img src="{% static 'assets/img/icons/cat-7.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">غذای دریایی</h4>#}
{#                            <p class="items" dir="rtl">652 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-8">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <span class="ms-lbl">%20</span>#}
{#                            <img src="{% static 'assets/img/icons/cat-8.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">فست فود</h4>#}
{#                            <p class="items" dir="rtl">253 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                    <div class="ms-cat-box ms-cat-box-9">#}
{#                        <a href="shop-left-sidebar-col-3.html" class="ms-cat-icon">#}
{#                            <img src="{% static 'assets/img/icons/cat-9.svg' %}" class="svg_img" alt="icon">#}
{#                            <h4 class="ms-cat-title">تخم مرغ</h4>#}
{#                            <p class="items" dir="rtl">154 عدد</p>#}
{#                        </a>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</section>#}
<!-- Category section End -->

<!-- Shop section -->
<section class="ms-shop padding-tb-30">
    <div class="container">
        <div class="m-b-30">
            <div class="row">
                <div class="col-md-6">
                    <div class="ms-ofr-banners">
                        <div class="ms-bnr-body">
                            <div class="ms-bnr-img">
                                <span class="lbl">%70 تخفیف</span>
                                <img src="{% static 'assets/img/banner/6.jpg' %}" alt="banner">
                            </div>
                            <div class="ms-bnr-detail">
                                <h5>میوه های تازه</h5>
                                <p>طعم یک چیز خاص</p>
                                <a href="shop-left-sidebar-col-3.html" class="ms-btn-2">خرید</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="ms-ofr-banners m-t-767">
                        <div class="ms-bnr-body">
                            <div class="ms-bnr-img">
                                <span class="lbl">%50 تخفیف</span>
                                <img src="{% static 'assets/img/banner/7.jpg' %}" alt="banner">
                            </div>
                            <div class="ms-bnr-detail">
                                <h5>ارگانیک و سبزیجات</h5>
                                <p>یک وعده غذایی سالم</p>
                                <a href="shop-left-sidebar-col-3.html" class="ms-btn-2">خرید</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="ms-shop-rightside col-lg-9 col-md-12 margin-b-30">
                <div class="shop-pro-content">
                    <div class="shop-pro-inner list-view">
                        <div class="row " >
                            <!-- محصولات اینجا قرار می‌گیرند -->
                            
                        </div>
                    </div>
                    <div class="ms-pro-pagination"></div>
                </div>
            </div>

            <!-- Sidebar Area Start -->
            <div class="ms-shop-sidebar col-lg-3 col-md-12 m-t-991">
                <div id="shop_sidebar">
                    <div class="ms-sidebar-wrap">
                        <div class="ms-sb-title">
                            <h3 class="ms-sidebar-title">تخصص
                                <div class="ms-sidebar-res"><i class="fas fa-chevron-down"></i></div>
                            </h3>
                        </div>
                        <div class="ms-sb-block-content">
                            <ul>
                                <!-- دسته‌بندی‌ها به‌صورت داینامیک اضافه می‌شوند -->
                            </ul>
                        </div>

                        <!-- Sidebar tags -->

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Shop section End -->

<!-- Footer Start -->
{% include '../extentions/footer.html' %}
<!-- Footer Area End -->

<!-- Quickview Modal -->
<div class="modal fade quickview-modal" id="ms_quickview_modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close qty_close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-5 col-sm-12 col-xs-12" dir="ltr">
                        <div class="qty-product-cover">
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/1_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/2_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/3_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/4_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/5_1.jpg' %}"
                                     alt="">
                            </div>
                        </div>
                        <div class="qty-nav-thumb">
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/1_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/2_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/3_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/4_1.jpg' %}"
                                     alt="">
                            </div>
                            <div class="qty-slide">
                                <img class="img-responsive" src="{% static 'assets/img/product-images/5_1.jpg' %}"
                                     alt="">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7 col-sm-12 col-xs-12">
                        <div class="quickview-pro-content">
                            <h5 class="ms-quick-title"><a href="product-left-sidebar.html">پاکت میوه خشک مخلوط تریل
                                ارگانیک مرغوب</a></h5>
                            <div class="ms-quickview-rating">
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star fill"></i>
                                <i class="fa-solid fa-star"></i>
                            </div>

                            <div class="ms-quickview-desc">لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و
                                با استفاده از طراحان گرافیک است. چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان
                                که لازم است
                            </div>
                            <div class="ms-quickview-price">
                                <span class="new-price">150 هزار تومان</span>
                                <span class="old-price">130 هزار تومان</span>
                            </div>

                            <div class="ms-pro-variation">
                                <div class="ms-pro-variation-inner ms-pro-variation-size ms-pro-size">
                                    <span>اندازه</span>
                                    <div class="ms-pro-variation-content">
                                        <ul class="ms-opt-size">
                                            <li class="active"><a href="javascript:void(0)" class="ms-opt-sz"
                                                                  data-tooltip="Small">250 گرم</a></li>
                                            <li><a href="javascript:void(0)" class="ms-opt-sz" data-tooltip="Medium">500
                                                گرم</a></li>
                                            <li><a href="javascript:void(0)" class="ms-opt-sz" data-tooltip="Large">1
                                                کیلوگرم</a></li>
                                            <li><a href="javascript:void(0)" class="ms-opt-sz"
                                                   data-tooltip="Extra Large">2 کیلوگرم</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="ms-quickview-qty">
                                <div class="qty-plus-minus">
                                    <input class="qty-input" type="text" name="ms_qtybtn" value="1">
                                </div>
                                <div class="ms-quickview-cart ">
                                    <button class="ms-btn-3"><img src="{% static 'assets/img/icons/pro_cart.svg' %}"
                                                                  class="svg_img pro_svg" alt=""> خرید
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Quickview Modal end -->

<!-- Add to Cart Notify -->
<div class="ms-cart-notify">
    <a href="javascript:void(0)" class="ms-cart-toggle"><img src="{% static 'assets/img/icons/pro_cart.svg' %}"
                                                             class="svg_img" alt="cart"><span>3</span></a>
</div>

<!-- Add to Wishlist Notify  -->
<div class="ms-wish-notify"></div>

<!-- Add to Compare list Notify  -->
<div class="ms-compare-notify"></div>

<!-- Back to top  -->
<a class="ms-back-to-top"></a>

<!-- Features sidebar  -->
<div class="ms-features-sidebar-overlay"></div>
<div class="ms-features-sidebar">
    <div class="tool-title">
        <h3>تنظیمات</h3>
    </div>
    <div class="ms-features-block">
        <div class="ms-features-title">رنگ‌ها</div>
        <ul class="bg-panel ms-change-color">
            <li class="active" data-color="01">
                <a href="javascript:void(0)" class="colorcode1"></a>
            </li>
            <li data-color="02">
                <a href="javascript:void(0)" class="colorcode2"></a>
            </li>
            <li data-color="03">
                <a href="javascript:void(0)" class="colorcode3"></a>
            </li>
            <li data-color="04">
                <a href="javascript:void(0)" class="colorcode4"></a>
            </li>
            <li data-color="05">
                <a href="javascript:void(0)" class="colorcode5"></a>
            </li>
            <li data-color="06">
                <a href="javascript:void(0)" class="colorcode6"></a>
            </li>
            <li data-color="07" class="">
                <a href="javascript:void(0)" class="colorcode7"></a>
            </li>
            <li data-color="08">
                <a href="javascript:void(0)" class="colorcode8"></a>
            </li>
            <li data-color="09">
                <a href="javascript:void(0)" class="colorcode9"></a>
            </li>
        </ul>
    </div>
    <div class="ms-features-block">
        <div class="ms-tools-sidebar-content">
            <div class="ms-features-title">حالت پس رمینه</div>
            <div class="ms-change-mode active" id="ms-change-mode">
                <div class="ms-mode-switch">
                    <div class="ms-mode-btn">انتخاب</div>
                    <div class="ms-mode-on">روشن</div>
                    <div class="ms-mode-off">خاموش</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Plugins JS -->
<script src="{% static 'assets/js/plugins/jquery-3.5.1.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/popper.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/bootstrap-select.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/fontawesome.js' %}"></script>
<script src="{% static 'assets/js/plugins/owl.carousel.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/swiper-bundle.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/infiniteslidev2.js' %}"></script>
<script src="{% static 'assets/js/plugins/jquery.zoom.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/slick.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/nouislider.js' %}"></script>

<!-- Main Js -->
<script src="{% static 'assets/js/main.js' %}">

</script>
<script>
    $(document).ready(function () {
        var selectedBranches = [];
        $.ajax({
            url: "/doctor/api/branch",
            method: "GET",
            success: function (response) {
                let sidebarContent = "";
                response.results.forEach(branch => {
                    sidebarContent += `
                <div class="ms-sidebar-block-item" style="display: flex; align-items: center;">
                    <input type="checkbox" id="branch-${branch.id}" class="branch-filter" data-id="${branch.id}">
                    <span style="margin-right: 10px; cursor: pointer; width: 20px; height: 20px;"></span>
                    <label for="branch-${branch.id}" style="flex: 1; display: block; position: relative; z-index: 0;">
                        <span class="label-text" style="margin-right: 5px;">${branch.name}</span>
                    </label>
                    <span class="checked"></span>
                </div>
            `;
                });
                $(".ms-sb-block-content").html(sidebarContent);
            },
            error: function () {
                console.error("خطا در دریافت شاخه‌های پزشکی!");
            }
        });
        $(document).on("change", ".branch-filter", function () {
            selectedBranches = [];

            $(".branch-filter:checked").each(function () {
                selectedBranches.push($(this).data("id"));
            });

            console.log(`selectedBranches after change: ${selectedBranches}`);

            // ارسال به تابع fetchDoctors با آرایه selectedBranches
            fetchDoctors(1, selectedBranches);
        });
        let currentPage = 1;

        fetchDoctors(currentPage, []);

        $(document).on("click", ".ms-pro-pagination-inner a", function (e) {
            e.preventDefault();
            let page = $(this).attr("data-page");
            if (page) {
                currentPage = parseInt(page);
                fetchDoctors(currentPage, selectedBranches);
            }
        });

        $("#branchFilter").on("change", function () {
            selectedBranches = $(this).val() || null;
            currentPage = 1;
            fetchDoctors(currentPage, selectedBranches);
        });

    });

    function fetchDoctors(page = 1, selectedBranches = []) {
        let apiUrl = `/doctor/api/doctors/?page=${page}`;

        // بررسی اینکه آیا هیچ شاخه‌ای انتخاب نشده است یا نه
        if (selectedBranches.length > 0) {
            apiUrl += `&branch=${selectedBranches.join(",")}`;
        }

        $.ajax({
            url: apiUrl,
            method: "GET",
            success: function (response) {
                renderDoctors(response.results);
                renderPagination(response.count, page);
            },
            error: function () {
                console.error("خطا در دریافت لیست پزشکان!");
            }
        });
    }

    function openModal(doctorData) {
        const doctor = JSON.parse(decodeURIComponent(doctorData));
        document.getElementById("modalImage").src = doctor.picture;
        document.getElementById("modalBranch").textContent = doctor.branch_name;
        document.getElementById("modalId").textContent = "ID: " + doctor.id;
        document.getElementById("doctorModal").style.display = "flex";
    }

    function closeModal() {
        document.getElementById("doctorModal").style.display = "none";
    }

    function renderDoctors(doctors) {
        let doctorList = "";

        if (doctors.length === 0) {
            doctorList = `<p class="text-center">هیچ پزشکی یافت نشد!</p>`;
        } else {
            doctors.forEach(doctor => {
                doctorList += `
                <div class=" mb-6 pro-gl-content ms-product-content width-100" onclick="window.location.href='${doctor.id}'">
                    <div class="ms-product-inner">
                        <div class="ms-pro-image-outer">
                            <div class="ms-pro-image">
                                <a href="doctor-profile.html?id=${doctor.id}" class="image">
                                    <img class="main-image img-doctor" src="${doctor.picture}" alt="${doctor.branch_name}">
                                </a>
                                <span class="flags">
                                    <span class="sale">${doctor.branch_name}</span>
                                </span>
                            </div>
                        </div>
                        <div class="ms-pro-content">
                            <h5 class="ms-pro-title"><a href="doctor-profile.html?id=${doctor.id}">دکتر ${doctor.user}</a></h5>
                            <div style='margin-right: 18px'>
                                <p class="ms-info detail-doctor">${doctor.description}</p>
                            </div>
                            <div class="ms-pro-rat-price">
                                <span class="ms-pro-rating">
                                    ${getStars(doctor.responsiveness)}
                                </span>
                                <span class="ms-price">
                                    <span class="new-price">${doctor.state === 1 ? "فعال" : "غیرفعال"}</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            });
        }

        $(".shop-pro-inner .row").html(doctorList);
    }

    function getStars(rating) {
        let stars = "";
        for (let i = 1; i <= 5; i++) {
            stars += `<i class="fa-solid fa-star ${i <= rating ? 'fill' : ''}"></i>`;
        }
        return stars;
    }

    function renderPagination(totalItems, currentPage) {
        let totalPages = Math.ceil(totalItems / 9);
        let paginationHtml = `<span>نمایش ${((currentPage - 1) * 9) + 1}-${Math.min(currentPage * 9, totalItems)} از ${totalItems} مورد</span>`;

        if (totalPages > 1) {
            paginationHtml += `<ul class="ms-pro-pagination-inner">`;

            if (currentPage > 1) {
                paginationHtml += `<li><a class="prev" data-page="${currentPage - 1}" href="#">قبلی</a></li>`;
            }

            for (let i = 1; i <= totalPages; i++) {
                paginationHtml += `<li><a class="${i === currentPage ? 'active' : ''}" data-page="${i}" href="#">${i}</a></li>`;
            }

            if (currentPage < totalPages) {
                paginationHtml += `<li><a class="next" data-page="${currentPage + 1}" href="#">بعدی</a></li>`;
            }

            paginationHtml += `</ul>`;
        }

        $(".ms-pro-pagination").html(paginationHtml);
    }

</script>
</body>

</html>